<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Certificate Platform</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    .video-container {
      margin-bottom: 40px;
    }
    input {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      background: gray;
      color: white;
      cursor: not-allowed;
    }
    button.active {
      background: green;
      cursor: pointer;
    }
    .course-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #1e90ff;
    }
  </style>
</head>
<body>

  <h1>Watch Videos & Get Your Certificate</h1>

  <!-- Video 1 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle1">HTML Basics Course</div>
    <div id="player1"></div>
    <br>
    <input type="text" id="name1" placeholder="Enter your name">
    <br>
    <button id="certBtn1" disabled>Get Certificate</button>
  </div>

  <!-- Video 2 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle2">JavaScript Beginner Course</div>
    <div id="player2"></div>
    <br>
    <input type="text" id="name2" placeholder="Enter your name">
    <br>
    <button id="certBtn2" disabled>Get Certificate</button>
  </div>

  <!-- Video 3 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle3">Python Course</div>
    <div id="player3"></div>
    <br>
    <input type="text" id="name3" placeholder="Enter your name">
    <br>
    <button id="certBtn3" disabled>Get Certificate</button>
  </div>

  <!-- Video 4 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle4">MS excel course</div>
    <div id="player4"></div>
    <br>
    <input type="text" id="name4" placeholder="Enter your name">
    <br>
    <button id="certBtn4" disabled>Get Certificate</button>
  </div>

  <div class="video-container">
    <div class="course-title" id="courseTitle5">c++ full Course</div>
    <div id="player5"></div>
    <br>
    <input type="text" id="name5" placeholder="Enter your name">
    <br>
    <button id="certBtn5" disabled>Get Certificate</button>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let players = {};
    let watchedSeconds = {};
    let lastTime = {};
    let watchIntervals = {};

    // Course titles
    const courseTitles = {
      1: "HTML Basics Course",
      2: "JavaScript Beginner Course",
      3: "Gorila Beginner Course",
      4: "Cobra Basics",
      5: "html basic"
    };

    // When YouTube API ready
    function onYouTubeIframeAPIReady() {
      createPlayer(1, 'HcOc7P5BMi4');
      createPlayer(2, 'hKB-YGF14SY');
      createPlayer(3, 'UrsmFxEIp5k');
      createPlayer(4, 'OX-iyb-21tk');
      createPlayer(5,'e7sAf4SbS_g');
    }

    // Create YouTube players
    function createPlayer(num, videoId) {
      players[num] = new YT.Player(`player${num}`, {
        height: '315',
        width: '560',
        videoId: videoId,
        events: {
          'onReady': () => restoreProgress(num),
          'onStateChange': (e) => onPlayerStateChange(e, num)
        }
      });

      watchedSeconds[num] = parseInt(localStorage.getItem(`watchedTime_${num}`)) || 0;
      lastTime[num] = 0;
    }

    // Player state changes
    function onPlayerStateChange(event, playerNum) {
      if (event.data === YT.PlayerState.PLAYING) {
        watchIntervals[playerNum] = setInterval(() => {
          let currentTime = Math.floor(players[playerNum].getCurrentTime());

          // Save last position
          localStorage.setItem(`lastPosition_${playerNum}`, currentTime);

          if (currentTime > lastTime[playerNum]) {
            watchedSeconds[playerNum]++;
            lastTime[playerNum] = currentTime;

            localStorage.setItem(`watchedTime_${playerNum}`, watchedSeconds[playerNum]);

            let duration = players[playerNum].getDuration();
            if (watchedSeconds[playerNum] >= duration * 0.1) {
              enableCertificate(playerNum);
            }
          }
        }, 1000);
      } else {
        clearInterval(watchIntervals[playerNum]);
      }
    }

    // Restore progress after refresh/reopen
    function restoreProgress(playerNum) {
      let savedTime = parseInt(localStorage.getItem(`watchedTime_${playerNum}`)) || 0;
      let lastPosition = parseInt(localStorage.getItem(`lastPosition_${playerNum}`)) || 0;

      watchedSeconds[playerNum] = savedTime;

      // Resume video from last saved position
      if (lastPosition > 0 && lastPosition < players[playerNum].getDuration()) {
        players[playerNum].seekTo(lastPosition, true);
      }

      let duration = players[playerNum].getDuration();
      if (savedTime >= duration * 0.3) {
        enableCertificate(playerNum);
      }
    }

    // Enable certificate button
    function enableCertificate(playerNum) {
      let btn = document.getElementById(`certBtn${playerNum}`);
      btn.disabled = false;
      btn.classList.add("active");
    }

    // Generate certificate
    function generateCertificate(inputId, playerNum) {
      const userName = document.getElementById(inputId).value.trim();
      if (!userName) {
        alert("Please enter your name before generating the certificate.");
        return;
      }

      const durationSeconds = players[playerNum].getDuration();
      const durationFormatted = formatDuration(durationSeconds);
      const courseName = courseTitles[playerNum];

      const certWindow = window.open('', '_blank');
      certWindow.document.write(`
        <html>
        <head>
          <title>Certificate</title>
          <style>
            body {
              font-family: 'Georgia', serif;
              background: white;
              text-align: center;
              padding: 40px;
            }
            .certificate {
              background: white;
              border: 10px solid gold;
              outline: 5px solid #1e90ff;
              padding: 40px;
              border-radius: 15px;
              max-width: 800px;
              margin: auto;
              box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            }
            h1 { font-size: 2.5rem; color: #1e90ff; margin-bottom: 10px; }
            h2 { font-size: 1.8rem; color: #d2691e; margin-bottom: 20px; }
            p { font-size: 1.2rem; color: #333; }
            .name {
              font-size: 1.8rem;
              font-weight: bold;
              margin: 20px 0;
              color: #000;
              border-bottom: 2px solid #1e90ff;
              display: inline-block;
              padding: 5px 15px;
            }
            .details { margin-top: 20px; font-size: 1rem; color: #555; }
          </style>
        </head>
        <body>
          <div class="certificate">
            <h1>Certificate of Completion</h1>
            <h2>${courseName}</h2>
            <p>This is to certify that</p>
            <div class="name">${userName}</div>
            <p>has successfully completed this course.</p>
            <div class="details">
              <p>Total Course Duration: <strong>${durationFormatted}</strong></p>
              <p>Date: ${new Date().toLocaleDateString()}</p>
            </div>
          </div>
        </body>
        </html>
      `);
      certWindow.document.close();
    }

    // Format duration
    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      if (mins >= 60) {
        const hours = Math.floor(mins / 60);
        const minutes = mins % 60;
        return `${hours}h ${minutes}m ${secs}s`;
      }
      return `${mins}m ${secs}s`;
    }

    // Attach button click handlers
    window.onload = function() {
      document.getElementById("certBtn1").addEventListener("click", () => generateCertificate("name1", 1));
      document.getElementById("certBtn2").addEventListener("click", () => generateCertificate("name2", 2));
      document.getElementById("certBtn3").addEventListener("click", () => generateCertificate("name3", 3));
      document.getElementById("certBtn4").addEventListener("click", () => generateCertificate("name4", 4));

      document.getElementById("certBtn5").addEventListener("click", () => generateCertificate("name5", 5));
    };
  </script>
</body>
</html>

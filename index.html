<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Certificate Platform</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .video-container { margin-bottom: 40px; }
    input {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      background: gray;
      color: white;
      cursor: not-allowed;
    }
    button.active {
      background: green;
      cursor: pointer;
    }
    .course-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #1e90ff;
    }
  </style>
</head>
<body>

  <h1>Watch Videos & Get Your Certificate</h1>

  <!-- Video 1 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle1">HTML Basics Course</div>
    <div id="player1"></div>
    <br>
    <input type="text" id="name1" placeholder="Enter your name">
    <br>
    <button id="certBtn1" disabled>Get Certificate</button>
  </div>

  <!-- Video 2 -->
  <div class="video-container">
    <div class="course-title" id="courseTitle2">JavaScript Beginner Course</div>
    <div id="player2"></div>
    <br>
    <input type="text" id="name2" placeholder="Enter your name">
    <br>
    <button id="certBtn2" disabled>Get Certificate</button>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let players = {};
    let watchedSeconds = {};
    let lastTime = {};
    let watchIntervals = {};

    // Store course titles (change here only ✅)
    const courseTitles = {
      1: "HTML Basics Course",
      2: "JavaScript Beginner Course"
    };

    function onYouTubeIframeAPIReady() {
      players[1] = new YT.Player('player1', {
        height: '315',
        width: '560',
        videoId: 'yf3f-igVMc0', // Video 1
        events: { 'onStateChange': (e) => onPlayerStateChange(e, 1) }
      });
      players[2] = new YT.Player('player2', {
        height: '315',
        width: '560',
        videoId: '3uekfV6npAk', // Video 2
        events: { 'onStateChange': (e) => onPlayerStateChange(e, 2) }
      });

      watchedSeconds[1] = 0; watchedSeconds[2] = 0;
      lastTime[1] = 0; lastTime[2] = 0;
    }

    function onPlayerStateChange(event, playerNum) {
      if (event.data === YT.PlayerState.PLAYING) {
        watchIntervals[playerNum] = setInterval(() => {
          let currentTime = Math.floor(players[playerNum].getCurrentTime());
          if (currentTime > lastTime[playerNum]) {
            watchedSeconds[playerNum]++;
            lastTime[playerNum] = currentTime;
            localStorage.setItem(`watchedTime_${playerNum}`, watchedSeconds[playerNum]);
            
            // ✅ Check 30% condition
            let duration = players[playerNum].getDuration();
            if (watchedSeconds[playerNum] >= duration * 0.1) {
              let btn = document.getElementById(`certBtn${playerNum}`);
              btn.disabled = false;
              btn.classList.add("active");
            }
          }
        }, 1000);
      } else {
        clearInterval(watchIntervals[playerNum]);
      }
    }

    function generateCertificate(inputId, playerNum) {
      const userName = document.getElementById(inputId).value.trim();
      if (!userName) { alert("Please enter your name before generating the certificate."); return; }

      const durationSeconds = players[playerNum].getDuration();
      const durationFormatted = formatDuration(durationSeconds);

      const courseName = courseTitles[playerNum]; // ✅ Pick course title automatically

      const certWindow = window.open('', '_blank');
      certWindow.document.write(`
        <html>
        <head>
          <title>Certificate</title>
          <style>
            body {
              font-family: 'Georgia', serif;
              background: white;
              text-align: center;
              padding: 40px;
            }
            .certificate {
              background: white;
              border: 10px solid gold;
              outline: 5px solid #1e90ff;
              padding: 40px;
              border-radius: 15px;
              max-width: 800px;
              margin: auto;
              box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            }
            h1 { font-size: 2.5rem; color: #1e90ff; margin-bottom: 10px; }
            h2 { font-size: 1.8rem; color: #d2691e; margin-bottom: 20px; }
            p { font-size: 1.2rem; color: #333; }
            .name {
              font-size: 1.8rem;
              font-weight: bold;
              margin: 20px 0;
              color: #000;
              border-bottom: 2px solid #1e90ff;
              display: inline-block;
              padding: 5px 15px;
            }
            .details { margin-top: 20px; font-size: 1rem; color: #555; }
          </style>
        </head>
        <body>
          <div class="certificate">
            <h1>Certificate of Completion</h1>
            <h2>${courseName}</h2>
            <p>This is to certify that</p>
            <div class="name">${userName}</div>
            <p>has successfully completed this course.</p>
            <div class="details">
              <p>Total Course Duration: <strong>${durationFormatted}</strong></p>
              <p>Date: ${new Date().toLocaleDateString()}</p>
            </div>
          </div>
        </body>
        </html>
      `);
      certWindow.document.close();
    }

    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      if (mins >= 60) {
        const hours = Math.floor(mins / 60);
        const minutes = mins % 60;
        return `${hours}h ${minutes}m ${secs}s`;
      }
      return `${mins}m ${secs}s`;
    }

    // Attach button click handlers
    window.onload = function() {
      document.getElementById("certBtn1").addEventListener("click", () => generateCertificate("name1", 1));
      document.getElementById("certBtn2").addEventListener("click", () => generateCertificate("name2", 2));
    };
  </script>
</body>
</html>
